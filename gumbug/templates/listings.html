{% extends '_base.html' %}

{% block title %}{{ search.name }} | Gumbug Search{% endblock %}

{% block headerjs %}

<script>
	function initialize() {
		var map_canvas, mapOptions, map, loc;

{% for listing in listings %}
	{% if listing.lat and listing.lon %}

		loc = new google.maps.LatLng({{ listing.lat }}, {{ listing.lon }});
		map_canvas = document.getElementById('map_canvas_{{ listing.id }}');
		mapOptions = {
			center: loc,
			zoom: 15,
			mapTypeId: google.maps.MapTypeId.ROADMAP
		};
		map = new google.maps.Map(map_canvas, mapOptions);
		new google.maps.Marker({position: loc, map: map,});

	{% endif %}
{% endfor %}
	}
	google.maps.event.addDomListener(window, 'load', initialize);
</script>

{% endblock %}

{% block body %}

<div class="row">
	<span class="small">{{ search.slug }}</span>
	<h1>[{{ search.modified|date:"SHORT_DATETIME_FORMAT" }}] - Gumbug search</h1>
</div>

Showing results from:
<ul>
{% for search_url in search.searchurl_set.all %}
	<li><a href="{{ search_url.url }}" target="_blank">{{ search_url.url }}</a></li>
{% endfor %}
</ul>

<a class="btn btn-primary" href="{% url 'index' %}">New search</a>
<form action="{% url 'listings' search.slug %}" method="POST" style="display: inline;">
{% csrf_token %}
<input type="submit" class="btn btn-info" value="Redo search with same parameters"><br>
</form>
(Redoing the search will automatically continue to ignore the items that you added to your ignore list)

<div class="row"><h4>{{ listings|length }} listings</h4></div>

{% for listing in listings %}
	{% include "_listing.html" %}
{% endfor %}

{% if ignored_listings %}
<div class="row"><h4>Ignored listings</h4></div>
{% for listing in ignored_listings %}
	{% include "_listing.html" %}
{% endfor %}
{% endif %}

{% endblock %}
